<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate next generation contact matrices — generate_ngm • conmat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate next generation contact matrices — generate_ngm"><meta name="description" content='Once infected, a person can transmit an infectious disease to
another, creating generations of infected individuals. We can define a
matrix describing the number of newly infected individuals in given
categories, such as age, for consecutive generations. This matrix is
called a "next generation matrix" (NGM). We can generate an NGM from two
sources - a conmat_population object (such as the output from
abs_age_lga()), or a conmat_setting_prediction_matrix, which is the
output from extrapolate_polymod() or predict_setting_contacts().'><meta property="og:description" content='Once infected, a person can transmit an infectious disease to
another, creating generations of infected individuals. We can define a
matrix describing the number of newly infected individuals in given
categories, such as age, for consecutive generations. This matrix is
called a "next generation matrix" (NGM). We can generate an NGM from two
sources - a conmat_population object (such as the output from
abs_age_lga()), or a conmat_setting_prediction_matrix, which is the
output from extrapolate_polymod() or predict_setting_contacts().'><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conmat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/conmat-population.html">Conmat Population Data</a></li>
    <li><a class="dropdown-item" href="../articles/data-sources.html">Data Sources</a></li>
    <li><a class="dropdown-item" href="../articles/example-pipeline.html">Example Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/other-data-sources.html">Using other data sources</a></li>
    <li><a class="dropdown-item" href="../articles/parallel-computing.html">Parallel Computing</a></li>
    <li><a class="dropdown-item" href="../articles/sir-model.html">SIR modelling with conmat</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-conmat.html">Visualisation gallery</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/idem-lab/conmat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate next generation contact matrices</h1>
      <small class="dont-index">Source: <a href="https://github.com/idem-lab/conmat/blob/master/R/generate-ngm.R" class="external-link"><code>R/generate-ngm.R</code></a></small>
      <div class="d-none name"><code>generate_ngm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Once infected, a person can transmit an infectious disease to
another, creating generations of infected individuals. We can define a
matrix describing the number of newly infected individuals in given
categories, such as age, for consecutive generations. This matrix is
called a "next generation matrix" (NGM). We can generate an NGM from two
sources - a <code>conmat_population</code> object (such as the output from
<code><a href="abs_age_data.html">abs_age_lga()</a></code>), or a <code>conmat_setting_prediction_matrix</code>, which is the
output from <code><a href="extrapolate_polymod.html">extrapolate_polymod()</a></code> or <code><a href="predict_setting_contacts.html">predict_setting_contacts()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">generate_ngm</span><span class="op">(</span><span class="va">x</span>, <span class="va">age_breaks</span>, <span class="va">R_target</span>, <span class="va">setting_transmission_matrix</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'conmat_setting_prediction_matrix'</span></span>
<span><span class="fu">generate_ngm</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">age_breaks</span>,</span>
<span>  <span class="va">R_target</span>,</span>
<span>  setting_transmission_matrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  per_capita_household_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">lga_name</span>,</span>
<span>  <span class="va">state_name</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'conmat_population'</span></span>
<span><span class="fu">generate_ngm</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">age_breaks</span>,</span>
<span>  <span class="va">R_target</span>,</span>
<span>  setting_transmission_matrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  per_capita_household_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">lga_name</span>,</span>
<span>  <span class="va">state_name</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>data input - could be a <code>conmat_population</code> (such as the output from
<code><a href="abs_age_data.html">abs_age_lga()</a></code>), or a <code>conmat_setting_prediction_matrix</code>, which is the
output from <code><a href="extrapolate_polymod.html">extrapolate_polymod()</a></code> or <code><a href="predict_setting_contacts.html">predict_setting_contacts()</a></code>.</p></dd>


<dt id="arg-age-breaks">age_breaks<a class="anchor" aria-label="anchor" href="#arg-age-breaks"></a></dt>
<dd><p>vector depicting age values with the highest age depicted
as <code>Inf</code>. For example, c(seq(0, 85, by = 5), Inf)</p></dd>


<dt id="arg-r-target">R_target<a class="anchor" aria-label="anchor" href="#arg-r-target"></a></dt>
<dd><p>target reproduction number</p></dd>


<dt id="arg-setting-transmission-matrix">setting_transmission_matrix<a class="anchor" aria-label="anchor" href="#arg-setting-transmission-matrix"></a></dt>
<dd><p>default is NULL, which calculates the transmission
matrix using <code>get_setting_transmission_matrices(age_breaks)</code>. You can
provide your own transmission matrix, but its rows and columns must match
the number of rows and columns, and must be a list of one matrix for each
setting. See the output for <code>get_setting_transmission_matrices(age_breaks)</code>
to get a sense of the structure. See <code><a href="get_setting_transmission_matrices.html">get_setting_transmission_matrices()</a></code>
for more detail.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>extra arguments, currently not used</p></dd>


<dt id="arg-per-capita-household-size">per_capita_household_size<a class="anchor" aria-label="anchor" href="#arg-per-capita-household-size"></a></dt>
<dd><p>default is NULL - which defaults to <code><a href="get_polymod_per_capita_household_size.html">get_polymod_per_capita_household_size()</a></code>, which gives 3.248971</p></dd>


<dt id="arg-lga-name">lga_name<a class="anchor" aria-label="anchor" href="#arg-lga-name"></a></dt>
<dd><p>now defunct, but capturing arguments for informative error</p></dd>


<dt id="arg-state-name">state_name<a class="anchor" aria-label="anchor" href="#arg-state-name"></a></dt>
<dd><p>now defunct, but capturing arguments for informative error</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A next generation matrix, containing the rates of contact between two age groups.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The NGM can be used to calculate the expected number of secondary
infections in a given age group. Given certain age breaks, we compute the
unscaled next generation matrices for that location across different
settings &amp; age groups using the contact rates extrapolated from POLYMOD
survey data on the specified location, adjusted by the per capita
household size and the setting-specific relative per-contact transmission
probability matrices for the same age groups. These NGMs are then scaled
according to a target reproduction number (which is provided as an
argument) using the ratio of the desired R0 and the R0 of the NGM
for the combination of all settings. The R0 of the combination of all
settings is obtained by calculating the unique, positive eigen value of
the combination NGM. This ratio is then used to scale all the setting
specific NGMs.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>When using a setting prediction contact matrix (such as one generated
by <code>extrapolate_polymod</code>, with class <code>conmat_setting_prediction_matrix</code>),
the age breaks specified in <code>generate_ngm</code> must be the same as the age
breaks specified in the synthetic contact matrix, otherwise it will error
as it is trying to multiple incompatible matrices.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">perth</span> <span class="op">&lt;-</span> <span class="fu"><a href="abs_age_data.html">abs_age_lga</a></span><span class="op">(</span><span class="st">"Perth (C)"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">perth_hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_abs_per_capita_household_size.html">get_abs_per_capita_household_size</a></span><span class="op">(</span>lga <span class="op">=</span> <span class="st">"Perth (C)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">age_breaks_0_80_plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># you can also run this without `per_capita_household_size`</span></span></span>
<span class="r-in"><span><span class="va">perth_ngm_lga</span> <span class="op">&lt;-</span> <span class="fu">generate_ngm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">perth</span>,</span></span>
<span class="r-in"><span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_0_80_plus</span>,</span></span>
<span class="r-in"><span>  per_capita_household_size <span class="op">=</span> <span class="va">perth_hh</span>,</span></span>
<span class="r-in"><span>  R_target <span class="op">=</span> <span class="fl">1.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">perth_contact</span> <span class="op">&lt;-</span> <span class="fu"><a href="extrapolate_polymod.html">extrapolate_polymod</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">perth</span>,</span></span>
<span class="r-in"><span>  per_capita_household_size <span class="op">=</span> <span class="va">perth_hh</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">perth_ngm</span> <span class="op">&lt;-</span> <span class="fu">generate_ngm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">perth_contact</span>,</span></span>
<span class="r-in"><span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_0_80_plus</span>,</span></span>
<span class="r-in"><span>  R_target <span class="op">=</span> <span class="fl">1.5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using our own transmission matrix</span></span></span>
<span class="r-in"><span><span class="va">new_transmission_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_setting_transmission_matrices.html">get_setting_transmission_matrices</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_0_80_plus</span>,</span></span>
<span class="r-in"><span>  <span class="co"># is normally 0.5</span></span></span>
<span class="r-in"><span>  asymptomatic_relative_infectiousness <span class="op">=</span> <span class="fl">0.75</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">new_transmission_matrix</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">perth_ngm_0_80_new_tmat</span> <span class="op">&lt;-</span> <span class="fu">generate_ngm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">perth_contact</span>,</span></span>
<span class="r-in"><span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_0_80_plus</span>,</span></span>
<span class="r-in"><span>  R_target <span class="op">=</span> <span class="fl">1.5</span>,</span></span>
<span class="r-in"><span>  setting_transmission_matrix <span class="op">=</span> <span class="va">new_transmission_matrix</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># examples not run as they take a long time</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">perth</span> <span class="op">&lt;-</span> <span class="fu"><a href="abs_age_data.html">abs_age_lga</a></span><span class="op">(</span><span class="st">"Perth (C)"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">perth_contact</span> <span class="op">&lt;-</span> <span class="fu"><a href="extrapolate_polymod.html">extrapolate_polymod</a></span><span class="op">(</span><span class="va">perth</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">generate_ngm</span><span class="op">(</span><span class="va">perth_contact</span>, age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, <a href="https://www.telethonkids.org.au/contact-us/our-people/g/nick-golding/" class="external-link">Nick Golding</a>, <a href="https://aarathybabu.netlify.app/" class="external-link">Aarathy Babu</a>, Chitra Saraswati, Michael Lydeamore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

