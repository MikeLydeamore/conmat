<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adds offset variables — add_offset • conmat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adds offset variables — add_offset"><meta name="description" content='Mostly used internally in add_modelling_features(). Adds two
offset variables to be used in fit_single_contact_model():
log_contactable_population_school, and
log_contactable_population.
These two variables require variables school_weighted_pop_fraction (from
add_school_work_participation()) and pop_age_to (from
add_school_work_participation()). This provides separate offsets
for school setting when compared to the other settings such as home,
work and other. The offset for school captures cohorting of students
for schools and takes the logarithm of the weighted combination of
contact population age distribution &amp;amp; school year probability calculated
in add_school_work_participation(). See "details" for more information.

'><meta property="og:description" content='Mostly used internally in add_modelling_features(). Adds two
offset variables to be used in fit_single_contact_model():
log_contactable_population_school, and
log_contactable_population.
These two variables require variables school_weighted_pop_fraction (from
add_school_work_participation()) and pop_age_to (from
add_school_work_participation()). This provides separate offsets
for school setting when compared to the other settings such as home,
work and other. The offset for school captures cohorting of students
for schools and takes the logarithm of the weighted combination of
contact population age distribution &amp;amp; school year probability calculated
in add_school_work_participation(). See "details" for more information.

'><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conmat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/conmat-population.html">Conmat Population Data</a></li>
    <li><a class="dropdown-item" href="../articles/data-sources.html">Data Sources</a></li>
    <li><a class="dropdown-item" href="../articles/example-pipeline.html">Example Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/other-data-sources.html">Using other data sources</a></li>
    <li><a class="dropdown-item" href="../articles/parallel-computing.html">Parallel Computing</a></li>
    <li><a class="dropdown-item" href="../articles/sir-model.html">SIR modelling with conmat</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-conmat.html">Visualisation gallery</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/idem-lab/conmat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adds offset variables</h1>
      <small class="dont-index">Source: <a href="https://github.com/idem-lab/conmat/blob/master/R/add_offset.R" class="external-link"><code>R/add_offset.R</code></a></small>
      <div class="d-none name"><code>add_offset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Mostly used internally in <code><a href="add_modelling_features.html">add_modelling_features()</a></code>. Adds two
offset variables to be used in <code><a href="fit_single_contact_model.html">fit_single_contact_model()</a></code>:</p><ol><li><p><code>log_contactable_population_school</code>, and</p></li>
<li><p><code>log_contactable_population</code>.
These two variables require variables <code>school_weighted_pop_fraction</code> (from
<code><a href="add_school_work_participation.html">add_school_work_participation()</a></code>) and <code>pop_age_to</code> (from
<code><a href="add_school_work_participation.html">add_school_work_participation()</a></code>). This provides separate offsets
for school setting when compared to the other settings such as home,
work and other. The offset for school captures cohorting of students
for schools and takes the logarithm of the weighted combination of
contact population age distribution &amp; school year probability calculated
in <code><a href="add_school_work_participation.html">add_school_work_participation()</a></code>. See "details" for more information.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_offset</span><span class="op">(</span><span class="va">contact_data</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-contact-data">contact_data<a class="anchor" aria-label="anchor" href="#arg-contact-data"></a></dt>
<dd><p>contact data - must contain columns <code>age_to</code>, <code>age_from</code>,
<code>pop_age_to</code> (from <code><a href="add_population_age_to.html">add_population_age_to()</a></code>, and
<code>school_weighted_pop_fraction</code> (from <code><a href="add_school_work_participation.html">add_school_work_participation()</a></code>)).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data.frame of <code>contact_data</code> with two extra columns:
<code>log_contactable_population_school</code> and <code>log_contactable_population</code></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>why double offsets? There are two offsets specified, once in the
model formula, and once in the "offset" argument of <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">mgcv::bam</a></code>. The
offsets get added together when the model first fit. In addition, the
setting specific offset from  <code>offset_variable</code>, which is included in the
GAM model as <code>... + offset(log_contactable_population)</code> is used in
prediction, whereas the other offset, included as an argument in the GAM
as <code>offset = log(participants)</code> is only included when the model is
initially created. See more detail in <code><a href="fit_single_contact_model.html">fit_single_contact_model()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nick Golding</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">age_min</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">age_max</span> <span class="op">&lt;-</span> <span class="fl">15</span></span></span>
<span class="r-in"><span><span class="va">all_ages</span> <span class="op">&lt;-</span> <span class="va">age_min</span><span class="op">:</span><span class="va">age_max</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  age_from <span class="op">=</span> <span class="va">all_ages</span>,</span></span>
<span class="r-in"><span>  age_to <span class="op">=</span> <span class="va">all_ages</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_population_age_to.html">add_population_age_to</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_school_work_participation.html">add_school_work_participation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">add_offset</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 36 × 14</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    age_from age_to pop_age_to intergenerational school_fraction_age_from</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>       10     10      0.161                 0                    0.922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>       10     11      0.163                 1                    0.922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>       10     12      0.165                 2                    0.922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>       10     13      0.168                 3                    0.922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>       10     14      0.170                 4                    0.922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>       10     15      0.173                 5                    0.922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>       11     10      0.161                 1                    0.931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>       11     11      0.163                 0                    0.931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>       11     12      0.165                 1                    0.931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>       11     13      0.168                 2                    0.931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 26 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 9 more variables: school_fraction_age_to &lt;dbl&gt;, school_probability &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   school_year_probability &lt;dbl&gt;, school_weighted_pop_fraction &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   work_fraction_age_from &lt;dbl&gt;, work_fraction_age_to &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   work_probability &lt;dbl&gt;, log_contactable_population_school &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   log_contactable_population &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, <a href="https://www.telethonkids.org.au/contact-us/our-people/g/nick-golding/" class="external-link">Nick Golding</a>, <a href="https://aarathybabu.netlify.app/" class="external-link">Aarathy Babu</a>, Chitra Saraswati, Michael Lydeamore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

