<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a single GAM contact model to a dataset — fit_single_contact_model • conmat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a single GAM contact model to a dataset — fit_single_contact_model"><meta name="description" content='This is the workhorse of the conmat package, and is typically
used inside fit_setting_contacts(). It predicts the contact rate between
all age bands (the contact rate between ages 0 and 1, 0 and 2, 0 and 3,
and so on), for a specified setting, with specific terms being added for
given settings. See "details" for further information.'><meta property="og:description" content='This is the workhorse of the conmat package, and is typically
used inside fit_setting_contacts(). It predicts the contact rate between
all age bands (the contact rate between ages 0 and 1, 0 and 2, 0 and 3,
and so on), for a specified setting, with specific terms being added for
given settings. See "details" for further information.'><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conmat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/conmat-population.html">Conmat Population Data</a></li>
    <li><a class="dropdown-item" href="../articles/data-sources.html">Data Sources</a></li>
    <li><a class="dropdown-item" href="../articles/example-pipeline.html">Example Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/other-data-sources.html">Using other data sources</a></li>
    <li><a class="dropdown-item" href="../articles/parallel-computing.html">Parallel Computing</a></li>
    <li><a class="dropdown-item" href="../articles/sir-model.html">SIR modelling with conmat</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-conmat.html">Visualisation gallery</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/idem-lab/conmat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit a single GAM contact model to a dataset</h1>
      <small class="dont-index">Source: <a href="https://github.com/idem-lab/conmat/blob/master/R/fit_single_contact_model.R" class="external-link"><code>R/fit_single_contact_model.R</code></a></small>
      <div class="d-none name"><code>fit_single_contact_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is the workhorse of the <code>conmat</code> package, and is typically
used inside <code><a href="fit_setting_contacts.html">fit_setting_contacts()</a></code>. It predicts the contact rate between
all age bands (the contact rate between ages 0 and 1, 0 and 2, 0 and 3,
and so on), for a specified setting, with specific terms being added for
given settings. See "details" for further information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_single_contact_model</span><span class="op">(</span></span>
<span>  <span class="va">contact_data</span>,</span>
<span>  <span class="va">population</span>,</span>
<span>  symmetrical <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  school_demographics <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  work_demographics <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-contact-data">contact_data<a class="anchor" aria-label="anchor" href="#arg-contact-data"></a></dt>
<dd><p>dataset with columns <code>age_to</code>, <code>age_from</code>, <code>setting</code>,
<code>contacts</code>, and <code>participants</code>. See <code><a href="get_polymod_contact_data.html">get_polymod_contact_data()</a></code> for
an example dataset - or the dataset in examples below.</p></dd>


<dt id="arg-population">population<a class="anchor" aria-label="anchor" href="#arg-population"></a></dt>
<dd><p><code>conmat_population</code> object, or data frame with columns
<code>lower.age.limit</code> and <code>population</code>. See <code><a href="get_polymod_population.html">get_polymod_population()</a></code> for
an example.</p></dd>


<dt id="arg-symmetrical">symmetrical<a class="anchor" aria-label="anchor" href="#arg-symmetrical"></a></dt>
<dd><p>whether to enforce symmetrical terms in the model.
Defaults to TRUE. See <code>details</code> for more information.</p></dd>


<dt id="arg-school-demographics">school_demographics<a class="anchor" aria-label="anchor" href="#arg-school-demographics"></a></dt>
<dd><p>(optional) defaults to census average proportion
at school. You can provide a dataset with columns, "age" (numeric), and
"school_fraction" (0-1), if you would like to specify these
details. See <code>abs_avg_school</code> for the default values. If you would like to
use the original school demographics used in conmat, these are provided in
the dataset, <code>conmat_original_school_demographics</code>.</p></dd>


<dt id="arg-work-demographics">work_demographics<a class="anchor" aria-label="anchor" href="#arg-work-demographics"></a></dt>
<dd><p>(optional) defaults to census average proportion
employed. You can provide a dataset with columns, "age" (numeric), and
"work_fraction", if you would like to specify these details. See
<code>abs_avg_work</code> for the default values. If you would like to
use the original work demographics used in conmat, these are provided in
the dataset, <code>conmat_original_work_demographics</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>single model</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The model fit is a Generalised Additive Model (GAM). We provide two
"modes" for model fitting. Either using "symmetric" or "non-symmetric"
model predictor terms with the logical variance "symmetrical", which is set
to TRUE by default. We recommend using the "symmetrical" terms as it
reflects the fact that contacts are symmetric - person A having contact
with person B means person B has had contact with person A. We've included
a variety of terms to account for assortativity with age, where people of
similar ages have more contact with each other. And included terms to
account for intergenerational contact patterns, where parents and
grandparents will interact with their children and grand children.
These terms are fit with a smoothing function. Specifically, the relevant
code looks like this:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># abs(age_from - age_to)</span></span>
<span><span class="fu">s</span><span class="op">(</span><span class="va">gam_age_offdiag</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co"># abs(age_from - age_to)^2</span></span>
<span><span class="fu">s</span><span class="op">(</span><span class="va">gam_age_offdiag_2</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co"># abs(age_from * age_to)</span></span>
<span><span class="fu">s</span><span class="op">(</span><span class="va">gam_age_diag_prod</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co"># abs(age_from + age_to)</span></span>
<span><span class="fu">s</span><span class="op">(</span><span class="va">gam_age_diag_sum</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co"># pmax(age_from, age_to)</span></span>
<span><span class="fu">s</span><span class="op">(</span><span class="va">gam_age_pmax</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co"># pmin(age_from, age_to)</span></span>
<span><span class="fu">s</span><span class="op">(</span><span class="va">gam_age_pmin</span><span class="op">)</span></span></code></pre><p></p></div>
<p>We also include predictors for the probability of attending school, and
attending work. These are computed as the probability that a person goes
to the same school/work, proportional to the increase in contacts due to
attendance. These terms are calculated from estimated proportion of
people in age groups attending school and work. See
<code><a href="add_modelling_features.html">add_modelling_features()</a></code> for more details.</p>
<p>Finally, we include two offset terms so that we estimate the contact rate,
that is the contacts per capita, instead of the number of contacts. These
offset terms are <code>log(contactable_population)</code>, and
<code>log(contactable_population_school)</code> when the model is fit to a school
setting. The contactable population is estimated as the interpolated
1 year ages from the data. For schools this is the contactable population
weighted by the proportion of the population attending school.</p>
<p>This leaves us with a model that looks like so:</p>
<p></p><div class="sourceCode r"><pre><code>mgcv::bam(
  formula = contacts ~
    # abs(age_from - age_to)
    s(gam_age_offdiag) +
    # abs(age_from - age_to)^2
    s(gam_age_offdiag_2) +
    # abs(age_from * age_to)
    s(gam_age_diag_prod) +
    # abs(age_from + age_to)
    s(gam_age_diag_sum) +
    # pmax(age_from, age_to)
    s(gam_age_pmax) +
    # pmin(age_from, age_to)
    s(gam_age_pmin) +
    school_probability +
    work_probability +
    offset(log_contactable_population) +
    # or for school settings
    # offset(log_contactable_population_school)
    family = stats::poisson,
  offset = log(participants),
  data = population_data
)
</code></pre><p></p></div>
<p>But if the term <code>symmetrical = FALSE</code> is used, you get:</p>
<p></p><div class="sourceCode r"><pre><code>mgcv::bam(
  formula = contacts ~
    s(age_to) +
    s(age_from) +
    s(abs(age_from - age_to)) +
    s(abs(age_from - age_to), age_from) +
    school_probability +
    work_probability +
    offset(log_contactable_population) +
    # or for school settings
    # offset(log_contactable_population_school)
    family = stats::poisson,
  offset = log(participants),
  data = population_data
)
</code></pre><p></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">example_contact</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span>setting <span class="op">=</span> <span class="st">"home"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_contact</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 8,787 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    setting age_from age_to contacts participants</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> home           0      0       10           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> home           0      1        7           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> home           0      2       12           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> home           0      3       14           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> home           0      4       11           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> home           0      5        6           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> home           0      6        9           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> home           0      7        9           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> home           0      8        6           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> home           0      9        6           92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 8,777 more rows</span></span>
<span class="r-in"><span><span class="va">example_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">example_contact_20</span> <span class="op">&lt;-</span> <span class="va">example_contact</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">age_to</span> <span class="op">&lt;=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>    <span class="va">age_from</span> <span class="op">&lt;=</span> <span class="fl">20</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">my_mod</span> <span class="op">&lt;-</span> <span class="fu">fit_single_contact_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>  contact_data <span class="op">=</span> <span class="va">example_contact_20</span>,</span></span>
<span class="r-in"><span>  population <span class="op">=</span> <span class="va">example_population</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># you can specify your own population data for school and work demographics</span></span></span>
<span class="r-in"><span><span class="va">my_mod_diff_data</span> <span class="op">&lt;-</span> <span class="fu">fit_single_contact_model</span><span class="op">(</span></span></span>
<span class="r-in"><span>  contact_data <span class="op">=</span> <span class="va">example_contact_20</span>,</span></span>
<span class="r-in"><span>  population <span class="op">=</span> <span class="va">example_population</span>,</span></span>
<span class="r-in"><span>  school_demographics <span class="op">=</span> <span class="va">conmat_original_school_demographics</span>,</span></span>
<span class="r-in"><span>  work_demographics <span class="op">=</span> <span class="va">conmat_original_work_demographics</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, <a href="https://www.telethonkids.org.au/contact-us/our-people/g/nick-golding/" class="external-link">Nick Golding</a>, <a href="https://aarathybabu.netlify.app/" class="external-link">Aarathy Babu</a>, Chitra Saraswati, Michael Lydeamore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

