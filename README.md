
<!-- README.md is generated from README.Rmd. Please edit that file -->

# conmat

<!-- badges: start -->

[![Codecov test
coverage](https://codecov.io/gh/njtierney/conmat/branch/master/graph/badge.svg)](https://codecov.io/gh/njtierney/conmat?branch=master)
[![R-CMD-check](https://github.com/njtierney/conmat/workflows/R-CMD-check/badge.svg)](https://github.com/njtierney/conmat/actions)
<!-- badges: end -->

The goal of conmat is to provide methods for producing contact matrices.

## Installation

You can install the development version from
[GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("njtierney/conmat")
```

## Example

``` r
library(conmat)
# build synthetic age-structured contact matrices with GAMs
# analysis of polymod data

# set age breaks
age_breaks_5y <- c(seq(0, 75, by = 5), Inf)
age_breaks_1y <- c(seq(0, 100, by = 1), Inf)

# fit a single overall contact model to polymod
m_all <- fit_single_contact_model(
  contact_data = get_polymod_contact_data("all"),
  population = get_polymod_population()
)

m_all
#> 
#> Family: poisson 
#> Link function: log 
#> 
#> Formula:
#> contacts ~ stats::offset(log(pop_age_to)) + s(age_to) + s(age_from) + 
#>     s(abs(age_from - age_to)) + school_probability + work_probability
#> 
#> Estimated degrees of freedom:
#> 8.66 8.59 8.74  total = 29.99 
#> 
#> fREML score: 31479.7
```

``` r
# predict contacts at 1y and 5y resolutions for inspection
synthetic_all_5y <- predict_contacts(
  model = m_all, 
  population = get_polymod_population(),
  age_breaks = age_breaks_5y
) %>%
  predictions_to_matrix()

synthetic_all_5y
#>               (0,5]    (5,10]   (10,15]   (15,20]   (20,25]   (25,30]   (30,35]
#> (0,5]    2.05852539 1.4099395 0.7337205 0.6120743 0.8068022 0.9932340 0.9436865
#> (5,10]   1.31868920 4.9556665 2.7778164 0.8382645 0.5381795 0.7558255 0.9865049
#> (10,15]  0.57411845 2.5093244 6.8003434 2.3710946 0.6293991 0.5728105 0.8504286
#> (15,20]  0.44367214 0.7216372 2.3489772 4.1182021 1.6235243 0.6785559 0.6549467
#> (20,25]  0.55323719 0.4366230 0.5893624 1.5558343 3.5657065 1.6643779 0.7073993
#> (25,30]  0.64406760 0.5748872 0.5011310 0.6092023 1.5368630 3.4782924 1.6511372
#> (30,35]  0.59183432 0.7228073 0.7141342 0.5670063 0.6330862 1.5544547 3.5697255
#> (35,40]  0.48259063 0.6966682 0.9217797 0.8288467 0.6050792 0.6632813 1.6656462
#> (40,45]  0.37578568 0.5557844 0.8678729 1.0430313 0.8617067 0.6134396 0.6866104
#> (45,50]  0.29266079 0.4266379 0.6831200 0.9688157 1.0761824 0.8661259 0.6241246
#> (50,55]  0.25943767 0.3402287 0.5391282 0.7833519 1.0277546 1.1127283 0.9069299
#> (55,60]  0.27922177 0.2894651 0.4206345 0.6050551 0.8131160 1.0381002 1.1340557
#> (60,65]  0.29890661 0.2762642 0.3224103 0.4252686 0.5680028 0.7451680 0.9641106
#> (65,70]  0.24636987 0.2874754 0.2970440 0.3157345 0.3892177 0.5077331 0.6733890
#> (70,75]  0.15913759 0.2668403 0.3381786 0.3183528 0.3141525 0.3742326 0.4910218
#> (75,Inf] 0.09571711 0.1428046 0.2512851 0.3224690 0.3164475 0.2983924 0.3264164
#>            (35,40]   (40,45]   (45,50]   (50,55]   (55,60]   (60,65]   (65,70]
#> (0,5]    0.7771845 0.5944289 0.4163114 0.2974375 0.2584781 0.2446653 0.1807211
#> (5,10]   0.9597511 0.7508578 0.5177027 0.3311482 0.2256686 0.1920726 0.1813374
#> (10,15]  1.1132380 1.0263101 0.7247315 0.4586516 0.2854659 0.1947201 0.1632776
#> (15,20]  0.9738739 1.2034268 1.0012782 0.6492041 0.3998318 0.2496833 0.1684542
#> (20,25]  0.6813471 0.9547243 1.0675686 0.8186562 0.5169302 0.3208102 0.1997376
#> (25,30]  0.7028586 0.6363559 0.8024654 0.8276694 0.6192016 0.3950014 0.2445675
#> (30,35]  1.7012098 0.6851621 0.5559955 0.6445836 0.6489027 0.4903714 0.3114048
#> (35,40]  3.7772566 1.6914965 0.6165510 0.4612720 0.5222991 0.5292328 0.3968676
#> (40,45]  1.7362898 3.6819096 1.4826018 0.4963923 0.3638672 0.4165291 0.4186208
#> (45,50]  0.6997828 1.6599317 3.1985962 1.1898394 0.3861272 0.2858031 0.3252845
#> (50,55]  0.6552198 0.6906156 1.4651666 2.6273568 0.9537843 0.3122232 0.2294905
#> (55,60]  0.9230575 0.6319668 0.6031143 1.1859719 2.0501435 0.7390903 0.2432864
#> (60,65]  1.0564217 0.8156674 0.5030160 0.4379830 0.8383787 1.4654492 0.5264975
#> (65,70]  0.8724721 0.9043066 0.6311318 0.3569176 0.3023839 0.5788576 0.9902808
#> (70,75]  0.6520503 0.7980251 0.7483345 0.4811030 0.2644487 0.2232025 0.4178785
#> (75,Inf] 0.4064902 0.5015023 0.5545563 0.5042177 0.3597019 0.2208343 0.1581754
#>             (70,75]   (75,Inf]
#> (0,5]    0.09311408 0.09667901
#> (5,10]   0.13423913 0.11700134
#> (10,15]  0.14867379 0.17599669
#> (15,20]  0.13587299 0.22758560
#> (20,25]  0.12908389 0.22634633
#> (25,30]  0.14465618 0.20367101
#> (30,35]  0.18230898 0.20749589
#> (35,40]  0.23813738 0.24509927
#> (40,45]  0.29613264 0.30200332
#> (45,50]  0.30917264 0.37298863
#> (50,55]  0.24671734 0.43321394
#> (55,60]  0.17046572 0.40794613
#> (60,65]  0.16317006 0.29840933
#> (65,70]  0.33982447 0.22804841
#> (70,75]  0.69611553 0.33914372
#> (75,Inf] 0.21644200 0.55974065
```

``` r
# predict contacts at 1y and 5y resolutions for inspection
synthetic_all_5y <- predict_contacts(
  model = m_all, 
  population = get_polymod_population(),
  age_breaks = age_breaks_5y
) %>%
  predictions_to_matrix()

synthetic_all_5y
#>               (0,5]    (5,10]   (10,15]   (15,20]   (20,25]   (25,30]   (30,35]
#> (0,5]    2.05852539 1.4099395 0.7337205 0.6120743 0.8068022 0.9932340 0.9436865
#> (5,10]   1.31868920 4.9556665 2.7778164 0.8382645 0.5381795 0.7558255 0.9865049
#> (10,15]  0.57411845 2.5093244 6.8003434 2.3710946 0.6293991 0.5728105 0.8504286
#> (15,20]  0.44367214 0.7216372 2.3489772 4.1182021 1.6235243 0.6785559 0.6549467
#> (20,25]  0.55323719 0.4366230 0.5893624 1.5558343 3.5657065 1.6643779 0.7073993
#> (25,30]  0.64406760 0.5748872 0.5011310 0.6092023 1.5368630 3.4782924 1.6511372
#> (30,35]  0.59183432 0.7228073 0.7141342 0.5670063 0.6330862 1.5544547 3.5697255
#> (35,40]  0.48259063 0.6966682 0.9217797 0.8288467 0.6050792 0.6632813 1.6656462
#> (40,45]  0.37578568 0.5557844 0.8678729 1.0430313 0.8617067 0.6134396 0.6866104
#> (45,50]  0.29266079 0.4266379 0.6831200 0.9688157 1.0761824 0.8661259 0.6241246
#> (50,55]  0.25943767 0.3402287 0.5391282 0.7833519 1.0277546 1.1127283 0.9069299
#> (55,60]  0.27922177 0.2894651 0.4206345 0.6050551 0.8131160 1.0381002 1.1340557
#> (60,65]  0.29890661 0.2762642 0.3224103 0.4252686 0.5680028 0.7451680 0.9641106
#> (65,70]  0.24636987 0.2874754 0.2970440 0.3157345 0.3892177 0.5077331 0.6733890
#> (70,75]  0.15913759 0.2668403 0.3381786 0.3183528 0.3141525 0.3742326 0.4910218
#> (75,Inf] 0.09571711 0.1428046 0.2512851 0.3224690 0.3164475 0.2983924 0.3264164
#>            (35,40]   (40,45]   (45,50]   (50,55]   (55,60]   (60,65]   (65,70]
#> (0,5]    0.7771845 0.5944289 0.4163114 0.2974375 0.2584781 0.2446653 0.1807211
#> (5,10]   0.9597511 0.7508578 0.5177027 0.3311482 0.2256686 0.1920726 0.1813374
#> (10,15]  1.1132380 1.0263101 0.7247315 0.4586516 0.2854659 0.1947201 0.1632776
#> (15,20]  0.9738739 1.2034268 1.0012782 0.6492041 0.3998318 0.2496833 0.1684542
#> (20,25]  0.6813471 0.9547243 1.0675686 0.8186562 0.5169302 0.3208102 0.1997376
#> (25,30]  0.7028586 0.6363559 0.8024654 0.8276694 0.6192016 0.3950014 0.2445675
#> (30,35]  1.7012098 0.6851621 0.5559955 0.6445836 0.6489027 0.4903714 0.3114048
#> (35,40]  3.7772566 1.6914965 0.6165510 0.4612720 0.5222991 0.5292328 0.3968676
#> (40,45]  1.7362898 3.6819096 1.4826018 0.4963923 0.3638672 0.4165291 0.4186208
#> (45,50]  0.6997828 1.6599317 3.1985962 1.1898394 0.3861272 0.2858031 0.3252845
#> (50,55]  0.6552198 0.6906156 1.4651666 2.6273568 0.9537843 0.3122232 0.2294905
#> (55,60]  0.9230575 0.6319668 0.6031143 1.1859719 2.0501435 0.7390903 0.2432864
#> (60,65]  1.0564217 0.8156674 0.5030160 0.4379830 0.8383787 1.4654492 0.5264975
#> (65,70]  0.8724721 0.9043066 0.6311318 0.3569176 0.3023839 0.5788576 0.9902808
#> (70,75]  0.6520503 0.7980251 0.7483345 0.4811030 0.2644487 0.2232025 0.4178785
#> (75,Inf] 0.4064902 0.5015023 0.5545563 0.5042177 0.3597019 0.2208343 0.1581754
#>             (70,75]   (75,Inf]
#> (0,5]    0.09311408 0.09667901
#> (5,10]   0.13423913 0.11700134
#> (10,15]  0.14867379 0.17599669
#> (15,20]  0.13587299 0.22758560
#> (20,25]  0.12908389 0.22634633
#> (25,30]  0.14465618 0.20367101
#> (30,35]  0.18230898 0.20749589
#> (35,40]  0.23813738 0.24509927
#> (40,45]  0.29613264 0.30200332
#> (45,50]  0.30917264 0.37298863
#> (50,55]  0.24671734 0.43321394
#> (55,60]  0.17046572 0.40794613
#> (60,65]  0.16317006 0.29840933
#> (65,70]  0.33982447 0.22804841
#> (70,75]  0.69611553 0.33914372
#> (75,Inf] 0.21644200 0.55974065

library(ggplot2)
plot_matrix(synthetic_all_5y) +
  ggtitle("synthetic all at once")
```

<img src="man/figures/README-matrix-plot-1.png" width="100%" />

## Code of Conduct

Please note that the conmat project is released with a [Contributor Code
of
Conduct](https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.
